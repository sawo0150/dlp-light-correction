# train.yaml

defaults:
  - _self_

  # âœ… DLP task ì„ íƒ (inverseë¶€í„°)
  - task: inverse

  # âœ… DLP ëª¨ë¸/ë°ì´í„°/ë¡œìŠ¤ëŠ” ìƒˆ ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¦¬
  # (ëª¨ë¸ êµ¬í˜„ì€ ì´í›„ì— ê°ˆì•„ë¼ìš°ê¸° ì‰¬ì›€: UNet / Pix2Pix ë“±)
  - model: dlp_unet_small
  - data: local_trainpack
  - LossFunction: BCEWithLogitsDice

  # ì•„ëž˜ëŠ” ê¸°ì¡´ hydra ë¼ˆëŒ€ ìž¬ì‚¬ìš©ìš© (í•„ìš” ì—†ìœ¼ë©´ ì ì§„ì ìœ¼ë¡œ ì œê±°)
  - optimizer: adamw
  - LRscheduler: CosineAnnealingLR
  - early_stop: none
  - aug: none

  # DLP inverseì—ì„œëŠ” ê¸°í•˜í•™ ë³€í™˜(rotate/flip/crop) ê¸°ë³¸ OFF ê¶Œìž¥.

# === ê³µí†µ í•™ìŠµ í•˜ì´í¼íŒŒë¼ë¯¸í„° ===
GPU_NUM: 0
batch_size: 2
val_batch_size: 2
training_accum_steps: 4 # ðŸŸ¢ ì¶”ê°€: 1ìž¥ì”© 4ë²ˆ ëª¨ì•„ì„œ ì—…ë°ì´íŠ¸ (ì‹¤ì œ ë°°ì¹˜ 4 íš¨ê³¼)
training_amp: true   # ðŸ”´ False (ë˜ëŠ” ì£¼ì„) -> true ë¡œ ë³€ê²½
num_epochs: 50
warmup_epochs: 0

lr: 1e-3
report_interval: 7000
seed: 430
num_workers: 8

exp_name: dlp_inverse_thr2mask_baseline

# âœ… DLP image I/O ê³µí†µ ì˜µì…˜ (Dataset/Transformì—ì„œ ì‚¬ìš©)
image:
  size: 1280          # TrainPackì´ 1280ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œë‹¤ë©´ ê·¸ëŒ€ë¡œ
  in_channels: 1      # thrëŠ” 1ch grayscale
  out_channels: 1     # maskë„ 1ch
  normalize: "0_1"    # uint8 [0,255] â†’ float [0,1]
  binarize_target: true   # maskëŠ” ìµœì¢…ì ìœ¼ë¡œ binaryë¼ë©´ true (í•„ìš”ì‹œ grayë„ ê°€ëŠ¥)

wandb:
  project: dlp_inverse_Debugging
  entity: swpants05-seoul-national-university        # W&B íŒ€/ê³„ì •
  use_wandb: true
  max_vis_per_cat: 5        # epoch ë§ˆë‹¤ ì¹´í…Œê³ ë¦¬ë³„ ì´ë¯¸ì§€ ìˆ˜ (0 â†’ ì•ˆ ì˜¬ë¦¼)

  use_visLogging: true
  use_receptiveField: false

# âœ… [Log Path Fix] Hydra ë¡œê·¸ê°€ í˜„ìž¬ í´ë”ì— ìŒ“ì´ì§€ ì•Šë„ë¡ ê²½ë¡œ ì§€ì •
hydra:
  run:
    # ê²°ê³¼ê°€ ì €ìž¥ë˜ëŠ” result í´ë” ë‚´ë¶€ë¡œ ì´ë™
    dir: ../result/${exp_name}/hydra_logs/${now:%Y-%m-%d}_${now:%H-%M-%S}
  sweep:
    dir: ../result/${exp_name}/hydra_sweep/${now:%Y-%m-%d}_${now:%H-%M-%S}
  job:
    chdir: false  # ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” ìž‘ì—… ë””ë ‰í† ë¦¬ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠìŒ (ê²½ë¡œ ì—ëŸ¬ ë°©ì§€)

# âœ… (ì„ íƒ) ì‹¤í—˜ íƒœê·¸/í•„í„°: TrainPack manifest ê¸°ë°˜ í•„í„°ë§ ì˜µì…˜
filters:
  modes: ["binary", "gray"]   # ë˜ëŠ” ["binary"]ë§Œ ë¨¼ì €
  dataset_allow: []          # ë¹„ì›Œë‘ë©´ ì „ì²´
  qc_filter: ""              # ì˜ˆ: "qc__ncc_mask1280_ld1280>0.2"