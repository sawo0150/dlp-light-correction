# train.yaml

defaults:
  - _self_

  # âœ… DLP task ì„ íƒ (inverseë¶€í„°)
  - task: inverse_1_gray

  # âœ… DLP ëª¨ë¸/ë°ì´í„°/ë¡œìŠ¤ëŠ” ìƒˆ ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¦¬
  # (ëª¨ë¸ êµ¬í˜„ì€ ì´í›„ì— ê°ˆì•„ë¼ìš°ê¸° ì‰¬ì›€: UNet / Pix2Pix ë“±)
  - model: unet_small
  - data: local_trainpack       # local_trainpack or localLaptop_trainpack
  - LossFunction: BCEWithLogitsL1Loss

  # ì•„ë˜ëŠ” ê¸°ì¡´ hydra ë¼ˆëŒ€ ì¬ì‚¬ìš©ìš© (í•„ìš” ì—†ìœ¼ë©´ ì ì§„ì ìœ¼ë¡œ ì œê±°)
  - optimizer: adamw
  - LRscheduler: CosineAnnealingLR
  - early_stop: none
  - aug: none

  # DLP inverseì—ì„œëŠ” ê¸°í•˜í•™ ë³€í™˜(rotate/flip/crop) ê¸°ë³¸ OFF ê¶Œì¥.

# === ê³µí†µ í•™ìŠµ í•˜ì´í¼íŒŒë¼ë¯¸í„° ===
GPU_NUM: 0
batch_size: 1
val_batch_size: 1
training_accum_steps: 4 # ğŸŸ¢ ì¶”ê°€: 1ì¥ì”© 4ë²ˆ ëª¨ì•„ì„œ ì—…ë°ì´íŠ¸ (ì‹¤ì œ ë°°ì¹˜ 4 íš¨ê³¼)
training_amp: true   # ğŸ”´ False (ë˜ëŠ” ì£¼ì„) -> true ë¡œ ë³€ê²½
num_epochs: 5
warmup_epochs: 0

lr: 1e-3
report_interval: 50000
seed: 430
num_workers: 8

exp_name: dlp_inverse_thr2mask_baseline

# âœ… [New] Evaluation / Benchmark Config
evaluation:
  benchmark:
    enable: true
    data_root: "data/benchmark_160"
    proxy_checkpoint: "../result/forward_1/checkpoints/best_model.pt" # Forward ëª¨ë¸(Simulator) ê²½ë¡œ
    log_every_n_epochs: 1
    forward_post:
      apply_sigmoid: true   # âœ… forward outputì´ logitsë©´ true
    inverse_post:
      apply_sigmoid: true     # logits -> sigmoid(prob) ì ìš© ì—¬ë¶€
      binarize: true          # prob(or raw) -> binary mask ì ìš© ì—¬ë¶€
      binarize_thr: 0.5       # binarize threshold (0~1)
    curing:
      threshold: 0.23529         # curing depth threshold (0~1, 60/255)
      binarize: true          # forward ì¶œë ¥ë„ thresholdë¡œ binaryë¡œ ë§Œë“¤ì§€ ì—¬ë¶€
    mask_pixelize:
      enable: true
      size: 160          # coarse grid size (ì˜ˆ: 160). infer_size=640ì´ë©´ 4x4 ë¸”ë¡ í‰ê· ì´ ë¨
      downsample: "mean" # mean(=area/avg) downsample
      upsample: "nearest"
      apply_to: "corr"   # "both" | "naive" | "corr"


# âœ… DLP image I/O ê³µí†µ ì˜µì…˜ (Dataset/Transformì—ì„œ ì‚¬ìš©)
image:
  size: 1280          # TrainPackì´ 1280ìœ¼ë¡œ ë§Œë“¤ì–´ì¡Œë‹¤ë©´ ê·¸ëŒ€ë¡œ
  in_channels: 1      # thrëŠ” 1ch grayscale
  out_channels: 1     # maskë„ 1ch
  normalize: "0_1"    # uint8 [0,255] â†’ float [0,1]
  binarize_target: true   # maskëŠ” ìµœì¢…ì ìœ¼ë¡œ binaryë¼ë©´ true (í•„ìš”ì‹œ grayë„ ê°€ëŠ¥)

wandb:
  project: dlp_inverse_Debugging
  entity: swpants05-seoul-national-university        # W&B íŒ€/ê³„ì •
  use_wandb: true
  
  # âœ… Train metric: iter ë‹¨ìœ„ ë¡œê¹…
  log_every_n_iters: 1000

  # âœ… Epochë§ˆë‹¤ ì´ë¯¸ì§€ ë¡œê¹… ê°œìˆ˜ (0ì´ë©´ ë”)
  log_images_per_epoch: 5
  log_images_split: "val"   # "train" | "val"

  use_visLogging: true

# âœ… [Log Path Fix] Hydra ë¡œê·¸ê°€ í˜„ì¬ í´ë”ì— ìŒ“ì´ì§€ ì•Šë„ë¡ ê²½ë¡œ ì§€ì •
hydra:
  run:
    # ê²°ê³¼ê°€ ì €ì¥ë˜ëŠ” result í´ë” ë‚´ë¶€ë¡œ ì´ë™
    dir: ../result/${exp_name}/hydra_logs/${now:%Y-%m-%d}_${now:%H-%M-%S}
  sweep:
    dir: ../result/${exp_name}/hydra_sweep/${now:%Y-%m-%d}_${now:%H-%M-%S}
  job:
    chdir: false  # ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” ì‘ì—… ë””ë ‰í† ë¦¬ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠìŒ (ê²½ë¡œ ì—ëŸ¬ ë°©ì§€)
