# configs/task/inverse_physics_binary.yaml
# Physics Inverse: target mask -> corrected mask (band) -> frozen forward -> soft curing -> L1(target)
# - x: target mask (mask_160)  ✅ (dataset 내부에서 input_source=mask_target로 처리)
# - y: target mask (mask_160)  ✅ (loss에서 target으로 사용)

name: inverse_physics_binary

inverse:
  # ✅ NEW: use target mask as model input (instead of thr_random)
  input_source: "mask_target"   # ["mask_target", "thr_random", "thr_fixed", "ld_1280_aligned"]

  # target policy
  target_key: "mask_160"
  preprocess:
    out_size: 640

  mode_condition: "from_manifest"

  data:
    modes: ["binary"]
    split_source: "manifest"
    dataset_allow: []
    qc_filter: ""

    # ✅ NEW: 도메인 믹스(가중치). "B1"처럼 prefix로 줘도 되고, "B1_Shape_Cutout"처럼 full name도 OK
    domain:
      enable: false    # true | false
      weights:
        B1: 1.0
        B2: 0.0
        B3: 0.0
        B4: 0.0
        B5: 0.0

    # ✅ NEW: split별 샘플 수 상한(0/누락이면 제한 없음)
    max_samples:
      train: 0
      val: 0
      test: 0

    # rows vs items 중 뭐를 "총 데이터 수"로 볼지 선택
    # - rows: manifest row 기준(현재 네가 겪은 상황처럼 expand_all이면 iter 증가 가능)
    # - items: 실제 dataloader iter 수 기준으로 제한
    max_samples_unit: "items"   # or "items"

    # ✅ NEW: epoch마다 train 샘플을 다시 뽑을지(원하면 true)
    resample_each_epoch: false

    # ✅ NEW: max_samples가 dataset 수보다 클 때 보충 허용(복원추출)
    with_replacement: false
    
    debug:
      enable: false
      examples: 5
